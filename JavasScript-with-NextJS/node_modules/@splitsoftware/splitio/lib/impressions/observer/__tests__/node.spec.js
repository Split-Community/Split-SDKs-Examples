"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _tapeCatch = _interopRequireDefault(require("tape-catch"));

var _node = _interopRequireDefault(require("../node"));

var _testUtils = require("./testUtils");

(0, _tapeCatch.default)('Node JS / Impression Observer Basic Functionality', function (assert) {
  var observer = (0, _node.default)();
  var imp = {
    keyName: 'someKey',
    feature: 'someFeature',
    label: 'in segment all',
    changeNumber: 123,
    time: Date.now()
  }; // Add 5 new impressions so that the old one is evicted and re-try the test.

  (0, _testUtils.generateImpressions)(5).forEach(function (ki) {
    observer.testAndSet(ki);
  });
  assert.is(observer.testAndSet(imp), undefined);
  assert.equal(observer.testAndSet(imp), imp.time);
  assert.end();
});